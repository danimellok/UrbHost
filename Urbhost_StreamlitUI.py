import streamlit as st
import joblib
import numpy as np
import pandas as pd

# Load the model
model = joblib.load('linear_regression_model.joblib')

# App Title
st.title("Airbnb Price Estimator")

# Input Fields
st.header("Input Details")

###DICTIONARY FOR CITY - COUNTRY SELECTION
cities_by_country = {
    "United States": [ 'los angeles', 'woodland hills', 'west hollywood', 'venice', 'venice beach', 'marina del rey', 'walnut', 'torrance', 'los angeles county', 'whittier', 'claremont', 'compton', 'covina', 'inglewood', 'rowland heights', 'la crescenta-montrose', 'beverly hills', 'north hollywood', 'calabasas', 'culver city', 'hollywood', 'diamond bar', 'pasadena', 'pomona', 'hacienda heights', 'hawthorne', 'hermosa beach', 'el segundo', 'manhattan beach', 'glendale', 'gardena', 'lakewood', 'la mirada', 'lancaster', 'mar vista', 'long beach', 'agoura hills', 'westlake village', 'santa clarita', 'alhambra', 'lynwood', 'malibu', 'arcadia', 'pico rivera', 'rancho palos verdes', 'redondo beach', 'santa monica', 'pacific palisades', 'monrovia', 'burbank', 'monterey park', 'palmdale', 'norwalk', 'topanga', 'van nuys', 'san gabriel', 'sherman oaks', 'rosemead', 'bellflower', 'azusa', 'altadena', 'south pasadena', 'stevenson ranch', 'studio city', 'south gate', 'temple city', 'nashville', 'new orleans', 'madison', 'brentwood', 'austin', 'west lake hills', 'lakeway', 'boston', 'allston', 'jamaica plain', 'roxbury crossing', 'chicago', 'denver', 'cambridge', 'somerville', 'brookline', 'charlestown', 'palos verdes estates', 'paramount', 'view park-windsor hills', 'west covina', 'la puente', 'el monte', 'encino', 'la verne', 'la habra heights', 'castaic', 'la cañada flintridge', 'montebello', 'lawndale', 'playa del rey', 'baldwin park', 'carson', 'cerritos', 'dorchester', 'brighton', 'oakland', 'emeryville', 'berkeley', 'piedmont', 'queens', 'astoria', 'long island city', 'bronx', 'new york', 'brooklyn', 'flushing', 'forest hills', 'staten island', 'rego park', 'jamaica', 'ridgewood', 'queens village', 'rockaway beach', 'portland', 'washington', 'washington, d.c.', 'san francisco', 'watsonville', 'santa cruz', 'aptos', 'soquel', 'seattle', 'chula vista', 'san diego', 'del mar', 'capitola', 'scotts valley', 'capitol heights', 'la jolla', 'avalon', 'glendora', 'san fernando', 'topanga canyon', 'sierra madre', 'downey', 'lomita', 'san pedro', 'ben lomond', 'boulder creek', 'felton', 'san dimas', 'duarte', 'oak park', 'valley village', 'woodside', 'sunnyside', 'manhattan', 'jackson heights', 'bushwick', 'ny', 'far rockaway', 'elmhurst', 'arverne', 'east elmhurst', 'maspeth', 'corona', 'daly city', 'los gatos', 'saint albans', 'westminster', 'signal hill'
        
    ],
    "United Kingdom": [ 'london', 'barnet', 'edgware', 'enfield', 'ilford', 'lewisham', 'morden', 'wimbledon', 'mitcham', 'greater london', 'londra', 'paddington', 'dagenham', 'richmond', 'twickenham', 'kingston upon thames', 'hounslow', 'isleworth', 'bromley', 'beckenham', 'orpington', 'feltham', 'brentford', 'bexleyheath', 'welling', 'manchester', 'wythenshawe', 'camden town', 'hampstead', '伦敦', 'london borough of tower hamlets', 'londres', 'hackney', 'london borough of hackney', 'london borough of wandsworth', 'kensington', 'london borough of southwark', 'edinburgh', 'croydon', 'south croydon', 'surbiton', 'thornton heath', 'harrow', 'ealing', 'romford', 'hornchurch', 'uxbridge', 'pinner', 'wembley', 'islington', 'stratford', 'barking', 'edimburgo', 'perivale', 'greenford', 'london, england, gb', 'greenwich', 'erith', 'belvedere', 'teddington', 'woodford', 'sutton', 'worcester park', 'purley', 'harlington', 'ruislip', 'hayes', 'stanmore', 'brent', 'bexley', 'london borough of islington', 'poplar', 'hammersmith', 'new malden', 'hampton', 'currie', 'walthamstow', 'southall', 'west drayton', 'brixton', 'notting hill', 'new barnet', 'lambeth', 'wandsworth', 'hampton hill', 'sidcup', 'chigwell', 'wallington', 'carshalton', 'northwood', 'coulsdon', 'camberwell', 'waterloo', 'northolt', 'putney', 'chelsea', 'queensferry', 'london borough of camden', 'bayswater', 'docklands', 'chislehurst', 'chiswick', 'queens park', 'forest hill', 'hampton wick', 'westminster', 'sydenham', 'eltham'
    ],
    "France": ['paris', 'boulogne-billancourt', 'levallois-perret', 'montrouge', 'saint-ouen', 'neuilly-sur-seine', 'paris-18e-arrondissement', 'pantin', 'paris-19e-arrondissement', 'paris, île-de-france, fr', 'paris-20e-arrondissement', 'paris-5e-arrondissement', 'paris-16e-arrondissement', 'paris-11e-arrondissement', 'paris-6e-arrondissement', 'paris-15e-arrondissement', 'paris-8e-arrondissement', 'saint-mandé', 'issy-les-moulineaux', 'paris-12e-arrondissement', 'paris-17e-arrondissement', 'paris-7e-arrondissement', 'paris-10e-arrondissement', 'paris-13e-arrondissement', 'gentilly', 'paris-2e-arrondissement', 'gaillard', 'le pré-saint-gervais', 'paris-4e-arrondissement', 'ivry-sur-seine', 'vincennes', 'paris-14e-arrondissement', 'paris-3e-arrondissement', 'paris-9e-arrondissement', 'charenton-le-pont', 'paris-1er-arrondissement', 'vanves'],
    "Germany": ['berlin'],
    "Australia": ['melbourne', 'docklands', 'south melbourne', 'kensington', 'southbank', 'east melbourne', 'north melbourne', 'west melbourne', 'carlton', 'south yarra', 'middle park', 'elwood', 'saint kilda', 'albert park', 'st kilda', 'saint kilda east', 'port melbourne', 'brunswick', 'brunswick west', 'brunswick east', 'coburg', 'pascoe vale', 'hadfield', 'blackburn', 'mont albert', 'box hill', 'burwood', 'croydon', 'mitcham', 'doncaster', 'warrandyte', 'windsor', 'armadale', 'toorak', 'malvern east', 'prahran', 'heidelberg', 'ivanhoe', 'northcote', 'fairfield', 'preston', 'reservoir', 'thornbury', 'saint albans', 'sunshine', 'frankston', 'seaford', 'west footscray', 'yarraville', 'maidstone', 'seddon', 'clayton', 'glen waverley', 'wheelers hill', 'eltham', 'greensborough', 'newport', 'williamstown', 'altona', 'bonbeach', 'parkdale', 'clayton south', 'footscray', 'springvale', 'keysborough', 'wyndham vale', 'point cook', 'westmeadows', 'sunbury', 'tullamarine', 'altona north', 'epping', 'fitzroy', 'richmond', 'fitzroy north', 'carlton north', 'collingwood', 'abbotsford', 'cremorne', 'brighton', 'brighton east', 'sandringham', 'hampton', 'moonee ponds', 'ascot vale', 'narre warren', 'berwick', 'wantirna south', 'bayswater', 'murrumbeena', 'caulfield south', 'caulfield north', 'elsternwick', 'carnegie', 'glen huntly', 'caulfield', 'hawthorn east', 'balwyn', 'ashburton', 'surrey hills', 'hawthorn', 'kew', 'camberwell', 'clifton hill', 'parkville', 'balaclava', 'saint kilda west', 'warburton', 'mount dandenong', 'badger creek', 'yarra glen', 'the patch', 'kallista', 'belgrave', 'upwey', 'travancore', 'heidelberg west', 'bundoora', 'balwyn north', 'malvern', 'dandenong', 'werribee', 'truganina', 'roxburgh park', 'flemington', 'rosanna', 'heidelberg heights', 'essendon', 'rowville', 'ormond', 'bentleigh east', 'coburg north', 'glenroy', 'pascoe vale south', 'doncaster east', 'park orchards', 'templestowe', 'donvale', 'caroline springs', 'sassafras', 'olinda', 'millgrove', 'healesville', 'glen iris', 'cheltenham', 'alphington', 'braybrook', 'hughesdale', 'mount waverley', 'oakleigh east', 'chadstone', 'ashwood', 'beaumaris', 'lennox head', 'bangalow', 'byron bay', 'suffolk park', 'coopers shoot', 'mullumbimby creek', 'clunes', 'new brighton', 'mullumbimby', 'myocum', 'brunswick heads', 'wilsons creek', 'the pocket', 'possum creek', 'broken head', 'goonengerry', 'south golden beach', 'yamba', 'casuarina', 'kingscliff', 'tweed heads', 'ocean shores', 'coorabell', 'sydney', 'watsons bay', 'rose bay', 'paddington', 'woollahra', 'bellevue hill', 'croydon park', 'scotland island', 'bilgola beach', 'avalon beach', 'great mackerel beach', 'avalon', 'whale beach', 'bayview', 'north narrabeen', 'palm beach', 'coogee', 'bondi junction', 'bondi', 'bondi beach', 'dover heights', 'waverley', 'bronte', 'north bondi', 'queens park', 'randwick', 'tamarama', 'maroubra', 'chifley', 'centennial park', 'south coogee', 'clovelly', 'waterloo', 'kingsford', 'matraville', 'little bay', 'vaucluse', 'greenwich', 'lane cove', 'lane cove north', 'cammeray', 'mcmahons point', 'neutral bay', 'north sydney', 'cremorne point', 'lavender bay', 'waverton', 'elizabeth bay', 'surry hills', 'darlinghurst', 'potts point', 'pyrmont', 'erskineville', 'glebe', 'wentworth point', 'newington', 'sydney olympic park', 'castle hill', 'hunters hill', 'darlington', 'redfern', 'rushcutters bay', 'chippendale', 'manly vale', 'dee why', 'queenscliff', 'curl curl', 'beacon hill', 'north balgowlah', 'killarney heights', 'forestville', 'narrabeen', 'collaroy', 'crows nest', 'wollstonecraft', 'kirribilli', 'saint leonards', 'revesby', 'bankstown', 'panania', 'earlwood', 'belmore', 'homebush west', 'strathfield', 'freshwater', 'allambie heights', 'frenchs forest', 'collaroy plateau', 'north manly', 'rosebery', 'camperdown', 'zetland', 'balgowlah', 'fairlight', 'manly', 'double bay', 'mosman', 'balgowlah heights', 'darling point', 'alexandria', 'millers point', 'drummoyne', 'rhodes', 'campbelltown', 'forest lodge', 'ultimo', 'newtown', 'haymarket', 'woolloomooloo', 'seaforth', 'mascot', 'eastgardens', 'pagewood', 'hillsdale', 'oatley', 'glenwood', 'south wentworthville', 'merrylands', 'westmead', 'ashfield', 'haberfield', 'summer hill', 'lewisham', 'marrickville', 'stanmore', 'petersham', 'saint peters', 'tempe', 'dulwich hill', 'leichhardt', 'cronulla', 'caringbah south', 'bundeena', 'sutherland', 'brighton-le-sands', 'rockdale', 'rozelle', 'annandale', 'balmain east', 'balmain', 'beecroft', 'west pennant hills', 'cherrybrook', 'parramatta', 'north parramatta', 'carlingford', 'ryde', 'marsfield', 'lilyfield', 'arncliffe', 'wolli creek', 'kogarah', 'sans souci', 'hurstville', 'birchgrove', 'turramurra', 'wahroonga', 'chatswood', 'artarmon', 'willoughby', 'box hill north', 'vermont south', 'forest hill', 'ripponlea', 'maribyrnong', 'st kilda east', 'sydenham', 'frankston south', 'emerald', 'bentleigh', 'highett', 'mentone', 'aspendale', 'noble park', 'williams landing', 'greenvale', 'malabar', 'warriewood', 'clareville', 'mona vale', 'bilgola plateau', 'toongabbie', 'botany', 'eastlakes', 'beverly hills', 'smithfield', 'ermington', 'granville', 'north ryde', 'putney', 'eastwood', 'st peters', 'enmore', 'waitara', 'thornleigh', 'clontarf', 'edgecliff', 'north strathfield', 'concord', 'lindfield', 'roseville', 'gordon', 'lane cove west', 'northwood', 'milsons point', 'kurraba point', 'auburn', 'baulkham hills', 'beaconsfield', 'brookvale', 'north curl curl', 'hurlstone park', 'riverwood', 'homebush', 'belrose', 'st kilda west', 'hoppers crossing', 'notting hill', 'spotswood', 'kingsville', 'mckinnon', 'princes hill', 'cockatoo', 'pakenham', 'ringwood', 'craigieburn', 'mulgrave', 'yarra junction', 'box hill south', 'oak park', 'ferntree gully', 'lilydale', 'mordialloc', 'ewingsdale', 'banora point', 'federal', 'east ballina', 'rosebank', 'pottsville', 'skennars head', 'newrybar', 'ballina', 'five dock', 'glenfield', 'killara', 'naremburn', 'hornsby', 'elanora heights', 'cromer', 'campsie', 'blacktown', 'bexley', 'dolls point', 'turrella', 'gladesville', 'canterbury', 'miranda', 'pymble', 'castle cove', 'carnes hill', 'penrith', 'kingsgrove', 'northmead', 'macquarie park', 'meadowbank', 'grafton', 'lismore', 'saint ives', 'penshurst', 'monterey', 'guildford', 'chiswick', 'kellyville', 'fingal head', 'caringbah', 'enfield', 'northbridge', 'chelsea', 'edithvale', 'kalorama', 'brooklyn', 'the rocks', 'sylvania', 'dundas valley', 'narraweena', 'burnley', 'st leonards', 'west ryde', 'donnybrook', 'arcadia', 'lynwood'
        
    ],
    "Spain": ['madrid', 'palma', 'palma de mallorca', 'can pastilla', 'alaró', 'lloseta', 'manacor', 'algaida', 'ariany', 'búger', 'maria de la salut', 'montuïri', 'petra', 'porreres', 'mallorca', 'sant joan', 'selva', 'mancor de la vall', 'sa vileta-son rapinya', 'inca', 'balearic islands', 'illes balears', 'costitx', 'llubí', 'sineu', 'muro', 'biniamar', 'sencelles', 'vilafranca de bonany', 'porto cristo', 'cala anguila-cala mendia', 'son macià', 'sant llorenç des cardassar', 'sa coma', 'can picafort', 'son serra de marina', 'santa margalida', 'artà', 'son carrió', 'son servera', 'consell', 'campos', 'sa ràpita', 'ses salines', 'felanitx', 'santanyí', 'portocolom', '马德里', 'pollença', 'puerto pollensa', 'port de pollença', 'pollensa / pollença', 'pollensa', 'cala sant vicenç', 'fornalutx', 'alcúdia', 'illetes', 'santa ponça', 'magaluf', 'calvià', 'cala vinyes', 'peguera', 'palmanova', 'costa de la calma', 'binissalem', 'estellencs', 'son moll', 'cala agulla', 'capdepera', 'cala mesquida', 'cala ratjada', 'font de sa cala', "s'illot-cala morlanda", 'colonia de sant pere', 'betlem', 'canyamel', 'es pelats', 'cala lliteres', 'llucmajor', 'sa torre', 'vallgornera', 'cala blava', 'puigderrós', 'cala llombards', "cala d'or", 'cala figuera', 'cala santanyí', 'es llombards', "s'alqueria blanca", 'colònia de sant jordi', 'sa pobla', 'esporles', 'portals nous', 'el toro', 'rotes velles', 'la puebla', 'santa eugènia', "port d'andratx", 'andratx', 'santa maria del camí', 'banyalbufar', 'alcudia', "port d'alcúdia", 'port d´alcudia', 'aucanada', 'puerto pollença', 'sóller', 'soller', 'port de sóller', 'valldemossa', 'campanet', 'barcelona', 'barcelona, catalunya, es', 'барселона', "l'hospitalet de llobregat", 'cala pi', 'deià', 'cala ferrera', 'cas concos des cavaller', 'ca´n picafort', 'santanyi', 'portopetro', 'el arenal', "s'arracó", 'sant elm', 'bunyola', 'playa de muro', 'platja de muro', 'puigpunyent', 'palma (mallorca)', 'palma, illes balears, es', 'cas català', 'sol de mallorca', "costa d'en blanes", 'binissalem-mallorca do', 'arenal', 'cales de mallorca', 'cala murada', 'cala mendia', 'marratxí', 'caimari', 'moscari', 'lloret de vistalegre', 'escorca', 'santa ponsa', 'barcelone', 'porto cristo novo', 'ses covetes', 'port des canonge', 'palmanyola', 'colonia sant pere', "urbanització s'estanyol", 'urbanització montferrutx', 'puerto de alcudia', 'cielo de bonaire', 'mal pas-bon aire', 'pollenca', 'llubi', 'deyá', 'deia', 'arta', 'orient', "s'illot", "s'estanyol de migjorn", 'biniali', "s'arenal", 'gènova', 'buger', 'torrenova', 'madrid, comunidad de madrid, es', "s'horta", 'cala millor', 'lluchmayor', 'ses palmeres', 'marratxinet', 'sa rapita'
        
    ],
    "Italy": ['rome', 'roma', 'trento', 'carano', 'arco', 'pinzolo', 'andalo', 'marilleva 1400', 'cogolo', 'tesero', 'ledro', 'mezzana', 'canazei', 'predazzo', 'san martino di castrozza', 'madonna di campiglio', 'tenno', 'levico terme', 'brez', 'riva del garda', 'molveno', 'baselga di piné', 'folgaria', 'alba-penia', 'campitello di fassa', 'malè', 'venezia', 'venice', 'lido', 'lido di venezia', 'lido di ostia', 'acilia-castel fusano-ostia antica', 'piana del sole', '罗马', 'municipio roma x', 'mestre venezia', 'marghera', 'venezia lido', 'rovereto', 'folgarida', 'campo carlo magno', 'cavalese', 'rabbi', 'passo del tonale', 'nago-torbole', 'pozza di fassa', 'mestre', "sant'antonio di mavignola", 'dro', 'moena', 'carisolo', 'la massimina-casal lumbroso', 'ostia', 'fiera di primiero', 'panchià', 'vigo di fassa', 'marino', 'ziano di fiemme', 'lavis', 'san lorenzo dorsino'],
    "Canada": ['montréal', 'montreal', 'westmount', 'dorval', 'pointe-claire', 'côte saint-luc', 'dollard-des-ormeaux', 'verdun', 'ville de québec', 'quebec', 'québec', 'québec city', 'quebec city', 'toronto', 'north york', 'vaughan', 'scarborough', 'vancouver', 'beaconsfield', 'outremont', 'hampstead'],
    "Denmark": ['frederiksberg', 'københavn', 'copenhagen', 'hellerup', 'københavn v', 'københavn n', 'københavn k', 'københavn s', 'vanløse', 'københavn nv', 'valby', 'brønshøj', 'københavn ø', 'frederiksberg c', 'rødovre', 'kastrup', 'københavn sv', 'copenhagen v'],
    "Austria": ['wien', 'vienna', '维也纳'],
    "Belgium": ['antwerpen', 'antwerp', 'etterbeek', 'ville de bruxelles', 'forest', 'saint-gilles', 'uccle', 'vorst', 'ixelles', 'elsene', 'ukkel', 'schaerbeek', 'woluwé-saint-lambert', 'woluwe-saint-lambert', 'bruxelles', 'brussels', 'brussel', 'city of brussels', 'woluwe-saint-pierre', 'jette', 'koekelberg', 'anderlecht', 'sint-gillis', 'auderghem', 'saint-josse-ten-noode', 'watermael-boitsfort', 'schaarbeek', 'molenbeek-saint-jean', 'evere', 'sint-jans-molenbeek', 'berchem-sainte-agathe', 'ganshoren', 'sint-lambrechts-woluwe'],
    "Greece": ['athina', 'athens', 'αθήνα'],
    "Hong Kong": ['hong kong', '香港島', 'hong kong, hong kong', 'kowloon', 'islands district', 'hong kong island', '香港', 'jordan', '尖沙咀', 'mong kok', 'tsim sha tsui', '香港香港', 'hk', '旺角', 'yau ma tei', 'sheung wan', 'sham shui po', 'wan chai', 'sai ying pun', 'central', 'yau tsim mong', 'yau tsim mong district', '佐敦', 'mongkok', 'lamma island', 'causeway bay', 'wanchai', '九龍', 'kennedy town', 'lantau island', '油麻地', 'hung hom', 'north point'],
    "Switzerland": ['genève', 'geneva', 'lancy', 'grand-lancy', 'carouge', 'versoix', 'thônex', 'chêne-bourg', 'meyrin', 'veyrier', 'chêne-bougeries', 'bellevue', 'onex', 'vernier', 'plan-les-ouates', 'le grand-saconnex', 'cologny', 'collonge-bellerive'],
    "Netherlands": ['amsterdam', 'amsterdam-zuidoost', 'amsterdam zuid-oost'],
    "Ireland": ['dublin', 'dublin 8', 'rathmines', 'clondalkin', 'sandymount', 'fairview', 'artane', 'ballsbridge', 'crumlin', 'cabra', 'glasnevin', 'ranelagh', 'ringsend', 'drimnagh', 'sutton', 'swords', 'malahide', 'monkstown', 'dundrum', 'foxrock', 'dalkey', 'blackrock', 'lucan', 'santry', 'donabate', 'portmarnock', 'clonskeagh', 'stepaside', 'dublin 1', 'kimmage', 'dublin 2', 'milltown', 'rathgar', 'dublin 7', 'clontarf', 'donaghmede', 'donnybrook', 'drumcondra', 'skerries', 'howth', 'ballinteer', 'booterstown', 'dublín', 'smithfield', 'teach mealóg', 'rush', 'blanchardstown', 'castleknock', 'dun laoghaire', 'sandyford', 'killiney', 'churchtown', 'baldoyle', 'dublin 4', 'irishtown', 'raheny', 'tallaght', 'marino', 'dolphins barn', 'bray', 'finglas']
}

# Country Selection
country = st.selectbox("Select Country", list(cities_by_country.keys()))

# City Selection (filtered by Country)
if country:
    city = st.selectbox(
        "Select City",
        cities_by_country[country],
        format_func=lambda x: x.title()  # Capitalize city names for display
    )

# Property Type Options
property_types = [
    "Apartment", "House", "Bed & Breakfast", "Condominium", "Loft",
    "Townhouse", "Villa", "Guesthouse", "Bungalow", "Dorm", "Boat",
    "Cabin", "Chalet", "Boutique hotel", "Serviced apartment", "Hostel",
    "Camper/RV", "Timeshare", "Guest suite"
]
property_type = st.selectbox("Property Type", property_types)

# Room Type Options
room_type = st.selectbox("Room Type", ["Entire home/apt", "Private room", "Shared room"])

# Numeric Inputs
accommodates = st.number_input("Accommodates", min_value=1, max_value=20, value=2, step=1)
bathrooms = st.number_input("Bathrooms", min_value=0.0, max_value=10.0, value=1.0, step=0.5)
bedrooms = st.number_input("Bedrooms", min_value=0, max_value=10, value=1, step=1)
beds = st.number_input("Beds", min_value=0, max_value=20, value=1, step=1)
bed_type = st.selectbox("Bed Type", ["Real Bed", "Futon", "Pull-out Sofa", "Couch", "Airbed"])
guests_included = st.number_input("Guests Included", min_value=0, max_value=20, value=1, step=1)

# Prediction Button
if st.button("Estimate Price"):
    # Prepare input for model
    input_data = pd.DataFrame([{
        "Property Type": property_type,
        "Room Type": room_type,
        "Country": country.lower(),  # Standardize to lowercase
        "City": city.lower(),        # Standardize to lowercase
        "Accommodates": accommodates,
        "Bathrooms": bathrooms,
        "Bedrooms": bedrooms,
        "Beds": beds,
        "Bed Type": bed_type,
        "Guests Included": guests_included
    }])

    try:
        # Model Prediction
        log_price = model.predict(input_data)
        estimated_price = np.exp(log_price[0])  # Convert log price to actual price

        st.success(f"Estimated Price: ${estimated_price:.2f}")
    except Exception as e:
        st.error(f"Error in prediction: {e}")
